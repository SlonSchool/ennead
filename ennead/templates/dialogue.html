{% extends 'base.html' %}

{% block title %}{{task.order_num}}. {{ task.name }}{% endblock %}

{% block body %}
	<div class="row">
		<div class="col-4 offset-4">
			<h3>{{ task.order_num }}. {{ task.name }}</h3>
			<p class="score">Балл: {{ thread.score }} из {{ task.base_score }}</p>
			<div class="task-description">{{ task.html_description|safe }}</div>
			{% if g.user.is_teacher %}
				<div class="task-solution">{{ task.html_solution|safe }}</div>
			{% endif %}
		</div>
	</div>
	{% for post in posts %}
		{% if post.author.is_teacher %}
			{% set offset_class = 'offset-1' %}
			{% if post.hide_from_student %}
				{% set post_class = 'post-teacher-hidden' %}
			{% else %}
				{% set post_class = 'post-teacher' %}
			{% endif %}
		{%else%}
			{% set offset_class = '' %}
			{% set post_class = 'post-student' %}
		{%endif%}
		<div class="row">
			<div class="col-11 {{offset_class}}">
				<div class="post {{post_class}} ">
					<div class="post-header">
						{% if g.user.is_teacher %}
							<div class="post-author">{{ post.author.username }}</div>
						{% endif %}
						<div class="post-date">{{ post.date.strftime('%d %B, %H:%M') }}</div>
					</div>
					<div class="post-body">{{ post.html_text|safe }}</div>
				</div>
			</div>
		</div>
	{% endfor %}
	<div class="row">
		<div class="col-8 offset-2">
			<hr/>
			<form id="post-form" action="{{ url_for('post_to_thread', task_id=task.id, student_id=student.id) }}" method="POST">
				<textarea name="text" placeholder="Решение задачи" id="post-textarea"></textarea>
				{% if g.user.is_teacher %}
					<div class="form-check">
					  <input class="form-check-input" type="checkbox" name="hide_from_student" value="hide_from_student" id="hide_from_student">
					  <label class="form-check-label" for="hide_from_student">
					    Скрыть комментарий от школьника
					  </label>
					</div>
					<div class="form-group row">
						<label for="score-setter" class="col-form-label col-2">Балл:</label>
						<div class="col-5">
							<input type="text" pattern="\d+(\.\d*)?" name="score" value={{ thread.score }} class="form-control" id="score-setter">
						</div>
					</div>
				{% endif %}
				<button class="btn btn-primary float-right" type="submit">Отправить</button>
			</form>
		</div>
	</div>
{% endblock %}
